# Marketplace Tracker

Проект для отслеживания товаров на маркетплейсах Wildberries и Ozon с объединением одинаковых товаров и отображением общей статистики.

## Архитектура

- **Backend**: Go (Gin framework) с PostgreSQL (по умолчанию)
- **Frontend**: React с Material UI
- **Аутентификация**: JWT токены
- **Шифрование**: AES для API-токенов
- **Контейнеризация**: Docker + Docker Compose

## Функциональность

- Регистрация/вход пользователей
- Добавление магазинов (WB и Ozon) по API-токенам
- Получение товаров из маркетплейсов с использованием настоящих API
- Ручное сопоставление одинаковых товаров из разных маркетплейсов
- Объединенная статистика по сопоставленным товарам
- Полноценный CRUD для сопоставлений товаров
- Современный, минималистичный UI с анимациями и переходами
- Улучшенная безопасность и обработка ошибок

## Установка и запуск

### Через Docker (рекомендуется)

```bash
# Клонирование репозитория
git clone git@github.com:Wladisl4W/kursovaya.git
cd kursovaya

# Запуск проекта с PostgreSQL (рекомендуется)
docker-compose up --build
```

> **Важно**: В текущей реализации используется PostgreSQL.

Приложение будет доступно:
- Frontend: http://localhost:3000
- Backend API: http://localhost:8080

### Без Docker

#### Backend

```bash
cd backend
go mod tidy
go run cmd/server/main.go
```

#### Frontend

```bash
cd frontend
npm install
# Создайте файл .env с переменными окружения
cp .env.example .env
npm start
```

## Настройка

### Переменные окружения

В `docker-compose.yml` можно изменить:

- `JWT_SECRET` — секретный ключ для JWT (должен быть не менее 32 символов)
- `ENCRYPTION_KEY` — ключ для шифрования API-токенов
- `DB_HOST` — хост базы данных (по умолчанию: postgres)
- `DB_PORT` — порт базы данных (по умолчанию: 5432)
- `DB_USER` — пользователь базы данных (по умолчанию: postgres)
- `DB_PASSWORD` — пароль базы данных (по умолчанию: password)
- `DB_NAME` — название базы данных (по умолчанию: marketplace_tracker)
- `ALLOW_ORIGINS` — разрешенные источники для CORS (по умолчанию: "")

Для frontend части используйте файл `.env` с переменной `REACT_APP_API_URL`.

## Структура проекта

```
project/
├── backend/                 # Go API
│   ├── cmd/
│   │   └── server/          # Точка входа
│   ├── internal/
│   │   ├── config/          # Конфигурация
│   │   ├── database/        # Подключение к БД
│   │   ├── models/          # Модели данных
│   │   ├── handlers/        # HTTP-хендлеры
│   │   ├── routes/          # Роуты
│   │   ├── service/         # Бизнес-логика
│   │   └── middleware/      # Middleware
│   └── pkg/
│       ├── api/             # API клиенты (WB, Ozon)
│       └── utils/           # Утилиты (шифрование, JWT)
├── frontend/                # React приложение
│   ├── src/
│   │   ├── components/      # Компоненты
│   │   ├── pages/           # Страницы
│   │   ├── services/        # Централизованный API сервис
│   │   ├── utils/           # Утилиты
│   │   └── styles/          # Стили
└── docker-compose.yml       # Docker конфигурация
```

## API Эндпоинты

### Аутентификация
- `POST /api/auth/register` — регистрация
- `POST /api/auth/login` — вход

### Магазины
- `GET /api/stores` — получить магазины (требует токен)
- `POST /api/stores` — добавить магазин (требует токен)
- `DELETE /api/stores/:id` — удалить магазин (требует токен)

### Товары
- `GET /api/products` — получить товары из маркетплейсов (требует токен)
- `GET /api/products/saved` — получить сохраненные товары из БД (требует токен)

### Сопоставления
- `GET /api/mappings` — получить сопоставления (требует токен)
- `POST /api/mappings` — создать сопоставление (требует токен)
- `DELETE /api/mappings/:id` — удалить сопоставление (требует токен)

## Технологии

- **Go** — серверный язык
- **Gin** — веб-фреймворк
- **PostgreSQL** — база данных
- **React** — фронтенд
- **Material UI** — компоненты
- **JWT** — аутентификация
- **AES** — шифрование токенов
- **Docker** — контейнеризация
- **Axios** — HTTP-клиент для API запросов

## Улучшения безопасности

- Валидация конфигурации при запуске
- Проверка длины ключа JWT (не менее 32 символов)
- Уменьшенное время жизни токенов (12 часов вместо 24)
- Улучшенная обработка CORS с конкретными источниками
- Валидация метода подписи JWT
- Таймауты для API-запросов (10 секунд)
- Логирование ошибок для отладки

## Особенности

- Все API-токены шифруются AES перед сохранением в БД
- Используются настоящие API эндпоинты Wildberries и Ozon
- Валидация входных данных на сервере и клиенте
- Централизованный сервис API в frontend для управления запросами
- Поддержка обоих маркетплейсов (WB и Ozon)
- Интуитивный интерфейс для сопоставления товаров
- Объединение статистики по сопоставленным товарам
- Обработка ошибок и валидация данных
- Современный дизайн с эффектами стеклянной морфологии
- Полностью протестированная и готовая к использованию система

## Тестирование

Для запуска тестов в backend:
```bash
cd backend
go test ./...
```

## Переменные окружения

Frontend использует переменные окружения из файла `.env`:
- `REACT_APP_API_URL` — URL для API сервера